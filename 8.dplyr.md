## dplyr包
### 函数类型：
dplyr基础函数只有5个，名称功能如下：
- `mutate()`:新增变量
- `select()`:选择变量
- `filter()`:筛选观测
- `arrange()`:数据排序
- `summarise()`:描述统计
这5个函数加上用于分组的函数`group_by()`以及管道操作符`%>%`,构成了dplyr的最常用函数。

除此之外，该包还提供了用与合并数据框、随机选取观测、计算变量频次与去之序位等功能的若干函数。

**以下操作请保证已经加载了dplyr包**
#### 1.新增变量：`mutate()`
研究者通常需要基于已有的变量创建新变量，并保存到原数据框中，然后进行后续分析。
基本用法：
```r
mutate(dataframe,
       newvar1 = expression1,
       newvar2 = expression2,
       ...
       )
```
其中，
- `dataframe` 表示待操纵的数据框
- `newvar1` 表示想生成的第1个变量
- `expression1` 表示生成第1个变量的命令。
- 生成更多变量可以以此类推
R中自带数据`women`给出了美国30~39周岁之间女性在不同平均身高下对应的平均体重，
但其单位分别为英寸（in）和磅（lb）。
将其转换为国际单位制会更容易为其他国家的分析者理解，转换公式如下：
- 1bin = 2.54 cm
- 1lb = 0.45 kg
首先观察原始数据。
```
women
```
现在，生成新变量`height_cm`和`weight_kg`，即以cm和kg为单位的身高和体重。命令如下：
```r
mutate(women, 
       height_cm = height * 2.54,
       weight_kg = weight * 0.45
       )
```
BMI指数（身体质量指数)是用体重（单位：kg）除以身高（单位：m）的平方得出的数字，则下面生成各平均身高和平均体重下对应的 BMI 指数，变量命名为bmi，并保留至小数点后1位。
```r
mutate((women,
       height_cm = height * 2.54
       weight_kg = weight * 0.45
       bmi = round((weight_kg / (height_cm / 100) ^ 2）, 1)
       )
```
BMI          | 肥胖程度
-------------|---------
< 18.5       | 偏瘦
 18.5~24.9   | 正常
 25.0~29.9   | 偏胖
 `>=`30.0    | 肥胖

 
 依据该表，对上述的BMI值进行分类，该变量命名为`bmi_class`。
 此时可利用dplyr包中的`case_when()`函数，此函数用于生成多重`if else`条件下的赋值，
 即，将某一变量按照特定取值条件划分为不同类型（因子），具体用法如下：
 ```
 women_bmi01 <- mutate(
   women_bmi,
   bmi_class = case_when(
     bmi < 18.5 ~ "underweight",
     between(bmi, 18.5, 22.9) ~ "normal",
     between(bmi, 23.0, 29.9) ~ "overweight",
     bmi >= 30 ~ "obesity"
     )
    )
  ```
  注意这里利用了dplyr包中的`between()`函数，`between(x, a, b)`的含义就在于
  判定向量`x`中的元素取值是否在闭区间[a,b]内，a,b表示两个实数。
  
  此外，R中的自有函数`cut()`，仍可在`mutate()`框架下完成同样的工作。
  ```r
  women_bmi03 <- mutate(
    women_bmi,
    bmi_class = cut(bmi,
    breaks = c(0, 18.5, 25, 30, 100),
    lables = c("underweight", "normal", "overweight", "obesity"),
    right = F）
    ）
  head(women_bmi03)
  ```
  
 
 
 
